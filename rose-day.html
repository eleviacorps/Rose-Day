<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rose Day</title>
<style>
@import url("https://fonts.googleapis.com/css2?family=Sniglet:wght@400;800&display=swap");

:root{
  --bg-1:#060306;
  --bg-2:#100710;
  --bg-3:#030205;
  --pink-100:#ffeef8;
  --pink-200:#ffd7eb;
  --pink-300:#ffb6d8;
  --pink-400:#ff7db9;
  --pink-500:#de4f92;
  --rose-red:#be145f;
  --leaf-1:#88db9d;
  --leaf-2:#2f8c58;
  --ink:#fff6fb;
  --panel:rgba(255, 255, 255, 0.08);
  --panel-stroke:rgba(255, 255, 255, 0.2);
  --shadow:0 16px 40px rgba(0, 0, 0, .48);
}

*{
  box-sizing:border-box;
}

html,
body{
  margin:0;
  width:100%;
  height:100%;
  min-height:100dvh;
  overflow:hidden;
}

body{
  font-family:"Sniglet", "Comic Sans MS", cursive;
  color:var(--ink);
  background:
    radial-gradient(circle at 18% 14%, #2b1121 0%, transparent 34%),
    radial-gradient(circle at 82% 12%, #281322 0%, transparent 32%),
    radial-gradient(circle at 50% 84%, #1b0e1f 0%, transparent 46%),
    linear-gradient(135deg, var(--bg-1), var(--bg-2) 54%, var(--bg-3) 100%);
}

body::before,
body::after{
  content:"";
  position:fixed;
  width:42vmax;
  height:42vmax;
  border-radius:50%;
  pointer-events:none;
  filter:blur(22px);
  opacity:.24;
  mix-blend-mode:screen;
}

body::before{
  top:-23vmax;
  right:-10vmax;
  background:radial-gradient(circle, rgba(255,116,176,.55), rgba(255,116,176,0));
  animation:drift 14s ease-in-out infinite alternate;
}

body::after{
  bottom:-22vmax;
  left:-15vmax;
  background:radial-gradient(circle, rgba(255,150,202,.25), rgba(255,150,202,0));
  animation:drift 16s ease-in-out infinite alternate-reverse;
}

body.perf-lite::before,
body.perf-lite::after{
  filter:blur(14px);
  opacity:.16;
}

body.perf-lite .panel{
  backdrop-filter:none;
}

body.perf-lite .giftRose{
  filter:none;
}

body.perf-lite .giftRose__petal{
  box-shadow:
    inset -5px -8px 10px rgba(125, 14, 65, .24),
    inset 3px 4px 8px rgba(255, 246, 252, .22);
}

body.perf-lite .giftRose__light{
  display:none;
}

body.perf-lite #particleField .particle{
  box-shadow:none;
  opacity:.22;
}

body.perf-lite .heartParticle{
  filter:none;
  opacity:.52;
}

.ambient{
  position:fixed;
  inset:0;
  overflow:hidden;
  pointer-events:none;
  z-index:0;
}

#particleField .particle{
  position:absolute;
  bottom:-12vh;
  width:var(--size);
  height:var(--size);
  border-radius:50%;
  background:rgba(255, 232, 245, .82);
  box-shadow:0 0 12px rgba(255, 182, 220, .85);
  left:var(--left);
  opacity:.3;
  animation:particleFloat var(--dur) linear infinite;
  animation-delay:var(--delay);
}

#heartField{
  opacity:0;
  transition:opacity .8s ease;
}

body.after-first #heartField{
  opacity:.92;
}

.heartParticle{
  position:absolute;
  bottom:-14vh;
  width:var(--size);
  height:var(--size);
  left:var(--left);
  transform:rotate(45deg);
  background:linear-gradient(145deg, #ffcae4, #ff6db4);
  border-radius:3px;
  opacity:.7;
  filter:drop-shadow(0 0 10px rgba(255, 121, 184, .7));
  animation:heartFloat var(--dur) linear infinite;
  animation-delay:var(--delay);
}

.heartParticle::before,
.heartParticle::after{
  content:"";
  position:absolute;
  width:100%;
  height:100%;
  border-radius:50%;
  background:inherit;
}

.heartParticle::before{
  left:-50%;
}

.heartParticle::after{
  top:-50%;
}

.scene{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:16px;
  padding:
    calc(22px + env(safe-area-inset-top))
    calc(22px + env(safe-area-inset-right))
    calc(22px + env(safe-area-inset-bottom))
    calc(22px + env(safe-area-inset-left));
  overflow-y:auto;
  overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  overscroll-behavior:contain;
  opacity:0;
  pointer-events:none;
  transition:opacity .95s ease;
  z-index:1;
}

.scene > *{
  flex-shrink:0;
}

.scene.active{
  opacity:1;
  pointer-events:auto;
}

.sceneTag{
  margin:0;
  text-transform:uppercase;
  letter-spacing:.2em;
  font-size:.76rem;
  color:rgba(255, 225, 242, .9);
}

.sceneTitle{
  margin:0;
  font-family:"Sniglet", "Comic Sans MS", cursive;
  font-weight:400;
  font-size:clamp(2.3rem, 6.7vw, 4.2rem);
  letter-spacing:.02em;
  line-height:.95;
  color:var(--pink-100);
  text-shadow:0 1px 0 rgba(255, 255, 255, .08);
}

.panel{
  width:min(94vw, 970px);
  border-radius:30px;
  border:1px solid var(--panel-stroke);
  background:linear-gradient(165deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
  box-shadow:var(--shadow);
  backdrop-filter:blur(6px);
  padding:26px clamp(16px, 3.7vw, 34px);
}

button.nextBtn{
  margin-top:16px;
  padding:11px 22px;
  border:none;
  border-radius:999px;
  font-family:"Sniglet", "Comic Sans MS", cursive;
  font-size:.95rem;
  font-weight:800;
  letter-spacing:.04em;
  text-transform:uppercase;
  color:#4e1730;
  background:linear-gradient(130deg, #ffe5f4, #ffbedf);
  box-shadow:
    0 0 0 1px rgba(255, 255, 255, .35) inset,
    0 6px 14px rgba(255, 96, 170, .28);
  cursor:pointer;
  transition:transform .2s ease, box-shadow .2s ease, opacity .2s ease;
}

button.nextBtn:hover{
  transform:translateY(-2px);
  box-shadow:
    0 0 0 1px rgba(255, 255, 255, .4) inset,
    0 8px 16px rgba(255, 96, 170, .35);
}

button.nextBtn:active{
  transform:translateY(0);
}

button.nextBtn:disabled{
  opacity:.45;
  cursor:not-allowed;
  transform:none;
}

#scene1{
  justify-content:flex-start;
  padding-top:36px;
}

.hero{
  text-align:center;
  margin-bottom:8px;
}

#roseStage{
  position:relative;
  width:min(92vw, 460px);
  height:min(74vh, 640px);
}

#roseAura{
  position:absolute;
  left:50%;
  top:34%;
  width:300px;
  height:300px;
  transform:translate(-50%, -50%);
  border-radius:50%;
  background:radial-gradient(circle, rgba(255,112,175,.36), rgba(255,112,175,0) 68%);
  animation:pulse 2.7s ease-in-out infinite;
}

.giftBouquet{
  position:absolute;
  inset:0;
  pointer-events:none;
  transform-origin:bottom center;
}

.giftRose{
  position:absolute;
  left:calc(50% + var(--x, 0px));
  bottom:var(--bottom, 18px);
  width:var(--w, 280px);
  height:var(--h, 520px);
  transform:translateX(-50%) scale(var(--scale, .84)) rotate(var(--tilt, 0deg));
  transform-origin:bottom center;
  pointer-events:none;
  filter:drop-shadow(0 0 16px rgba(255, 72, 151, .34));
  z-index:var(--z, 3);
}

.giftRose.fromCenter{
  left:50% !important;
  transform:translateX(-50%) scale(var(--scale, .84)) rotate(var(--tilt, 0deg));
  opacity:0;
}

#scene1.bloomed #giftBouquet .giftRose.fromCenter{
  animation:giftRoseFromCenter 1.28s cubic-bezier(.2,.84,.24,1) both;
  animation-delay:calc(var(--rose-delay, 0s) + .06s);
}

#scene2.active #tapBouquet .giftRose.fromCenter{
  animation:giftRoseFromCenter 1.12s cubic-bezier(.2,.84,.24,1) both;
  animation-delay:calc(var(--rose-delay, 0s) + .02s);
}

.giftRose__flower{
  position:absolute;
  inset:0;
  transform-origin:bottom center;
  animation:giftRoseSway 4.4s ease-in-out infinite;
  animation-play-state:paused;
}

#scene1.bloomed .giftRose__flower,
#scene2.active .giftRose.is-live .giftRose__flower{
  animation-play-state:running;
}

.giftRose__head{
  position:absolute;
  left:50%;
  top:92px;
  width:190px;
  height:180px;
  transform:translate(-50%, -12px) scale(.2);
  opacity:0;
  animation:giftRoseHeadIn 1.25s cubic-bezier(.18,.82,.26,1) forwards;
  animation-delay:calc(var(--rose-delay, 0s) + 2.2s);
  animation-play-state:paused;
  z-index:4;
}

#scene1.bloomed .giftRose__head,
#scene2.active .giftRose.is-live .giftRose__head{
  animation-play-state:running;
}

.giftRose__petal{
  position:absolute;
  left:50%;
  top:50%;
  width:72px;
  height:98px;
  border-radius:52% 48% 42% 58% / 70% 72% 28% 30%;
  background-image:linear-gradient(185deg, #ffe4f1 0%, #ff9bc9 38%, #f54f96 68%, #8f0d43 100%);
  box-shadow:
    inset -7px -10px 12px rgba(125, 14, 65, .33),
    inset 4px 5px 10px rgba(255, 246, 252, .28),
    0 0 14px rgba(255, 108, 181, .35);
  opacity:0;
  transform:translate(-50%, -50%) scale(.08) rotate(var(--rot));
  animation:giftPetalIn 1.2s cubic-bezier(.16,.88,.22,1) forwards;
  animation-delay:calc(var(--rose-delay, 0s) + var(--petal-delay));
  animation-play-state:paused;
  z-index:4;
}

#scene1.bloomed .giftRose__petal,
#scene2.active .giftRose.is-live .giftRose__petal{
  animation-play-state:running;
}

.giftRose__petal.core{
  width:56px;
  height:76px;
  background-image:linear-gradient(185deg, #ffe9f5 0%, #ffb4d8 45%, #f35b9f 74%, #951447 100%);
}

.giftRose__center{
  position:absolute;
  left:50%;
  top:50%;
  width:44px;
  height:44px;
  transform:translate(-50%, -50%) scale(.2);
  border-radius:50%;
  background:radial-gradient(circle at 28% 28%, #fff1f9, #ff7db6 62%, #b61d64 100%);
  box-shadow:0 0 14px rgba(255, 128, 191, .55);
  opacity:0;
  animation:giftCenterIn .8s ease forwards;
  animation-delay:calc(var(--rose-delay, 0s) + 3.25s);
  animation-play-state:paused;
  z-index:5;
}

#scene1.bloomed .giftRose__center,
#scene2.active .giftRose.is-live .giftRose__center{
  animation-play-state:running;
}

.giftRose__stem{
  position:absolute;
  left:50%;
  bottom:28px;
  width:13px;
  height:0;
  transform:translateX(-50%);
  border-radius:999px;
  background-image:linear-gradient(to top, #0d4f1f 0%, #2f9e44 62%, #aaf7bf 100%);
  box-shadow:
    0 0 10px rgba(120, 237, 155, .35),
    inset -2px 0 2px rgba(0, 0, 0, .2),
    inset 2px 0 3px rgba(255, 255, 255, .25);
  animation:giftStemGrow 2.35s cubic-bezier(.2,.84,.24,1) forwards;
  animation-delay:calc(var(--rose-delay, 0s) + .1s);
  animation-play-state:paused;
  z-index:1;
}

#scene1.bloomed .giftRose__stem,
#scene2.active .giftRose.is-live .giftRose__stem{
  animation-play-state:running;
}

.giftRose__stemLeaf{
  position:absolute;
  width:76px;
  height:34px;
  border-radius:86% 14% 80% 20% / 65% 35% 65% 35%;
  background-image:linear-gradient(145deg, #b8f8cb 8%, #42aa6d 84%);
  box-shadow:
    inset -4px -2px 6px rgba(13, 79, 31, .2),
    0 0 10px rgba(120, 237, 155, .28);
  opacity:0;
  animation:giftLeafIn 1s ease forwards;
  animation-play-state:paused;
  z-index:2;
}

#scene1.bloomed .giftRose__stemLeaf,
#scene2.active .giftRose.is-live .giftRose__stemLeaf{
  animation-play-state:running;
}

.giftRose__stemLeaf.left{
  left:50%;
  bottom:var(--leaf-left, 182px);
  transform:translateX(-104%) rotate(-31deg);
  animation-delay:calc(var(--rose-delay, 0s) + 1.08s);
}

.giftRose__stemLeaf.right{
  left:50%;
  bottom:var(--leaf-right, 248px);
  transform:translateX(2%) rotate(28deg) scaleX(-1);
  animation-delay:calc(var(--rose-delay, 0s) + 1.32s);
}

.giftRose__light{
  position:absolute;
  bottom:26px;
  left:50%;
  width:10px;
  height:10px;
  margin-left:-5px;
  border-radius:50%;
  background:radial-gradient(circle, #ffd7ea 0%, #ff6ba9 70%, rgba(255, 107, 169, 0) 100%);
  filter:blur(.4px);
  opacity:0;
  animation:giftLightFloat 3.8s linear infinite;
  animation-delay:calc(var(--rose-delay, 0s) + var(--light-delay));
  animation-play-state:paused;
  z-index:6;
}

#scene1.bloomed .giftRose__light,
#scene2.active .giftRose.is-live .giftRose__light{
  animation-play-state:running;
}

.sceneHint{
  margin:2px 0 0 0;
  font-size:1.15rem;
  color:rgba(255, 221, 238, .82);
  text-shadow:none;
}

#scene2 .panel{
  text-align:center;
  width:min(92vw, 700px);
}

#tapFlowerWrap{
  display:flex;
  justify-content:center;
  margin-top:6px;
}

#tapFlower{
  position:relative;
  width:276px;
  height:304px;
  border:none;
  background:transparent;
  cursor:pointer;
  padding:0;
}

#tapFlower::before{
  content:"";
  position:absolute;
  left:50%;
  top:40%;
  width:188px;
  height:188px;
  transform:translate(-50%, -50%);
  border-radius:50%;
  background:radial-gradient(circle, rgba(255,145,200,.3), rgba(255,145,200,0) 70%);
}

#tapFlower.pulse{
  animation:tapPulse .3s ease;
}

.tapBouquet{
  position:relative;
  width:100%;
  height:100%;
  pointer-events:none;
}

#tapFlower .giftRose{
  bottom:6px;
  contain:layout paint;
}

#tapFlower .tapRose .giftRose__light{
  display:none;
}

#tapFlower .tapRose .giftRose__petal{
  box-shadow:
    inset -4px -7px 9px rgba(125, 14, 65, .24),
    inset 3px 4px 8px rgba(255, 246, 252, .2);
}

#tapFlower .tapRose .giftRose__flower{
  animation-duration:5.6s;
}

.tapStem{
  position:absolute;
  left:50%;
  bottom:24px;
  width:9px;
  height:145px;
  transform:translateX(-50%);
  border-radius:999px;
  background:linear-gradient(180deg, #9aefb4, #2b8752);
  box-shadow:0 0 9px rgba(134, 234, 163, .42);
}

.tapStem::before,
.tapStem::after{
  content:"";
  position:absolute;
  width:42px;
  height:21px;
  border-radius:86% 14% 80% 20% / 65% 35% 65% 35%;
  background:linear-gradient(145deg, #a7f8c0, #47ab71);
}

.tapStem::before{
  right:3px;
  top:58px;
  transform:rotate(-32deg);
}

.tapStem::after{
  left:3px;
  top:92px;
  transform:rotate(28deg) scaleX(-1);
}

.tapHead{
  position:absolute;
  left:50%;
  top:35%;
  width:162px;
  height:162px;
  transform:translate(-50%, -50%);
  filter:drop-shadow(0 0 12px rgba(255, 104, 176, .36));
}

.tapPetal{
  position:absolute;
  left:50%;
  top:50%;
  width:28px;
  height:42px;
  border-radius:54% 54% 42% 42% / 70% 70% 30% 30%;
  background:radial-gradient(circle at 36% 24%, #fff4fb 0%, #ffc8e3 42%, #f46ea9 76%, #b92f6b 100%);
  box-shadow:0 0 5px rgba(255, 126, 189, .24);
  transform-origin:50% 82%;
}

.tapCenter{
  position:absolute;
  left:50%;
  top:50%;
  width:36px;
  height:36px;
  transform:translate(-50%, -50%);
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #ffe6f4, #ff94c7 65%, #d04a84);
  box-shadow:0 0 8px rgba(255, 122, 185, .28);
}

#tapPrompt{
  margin:8px 0 0 0;
  color:rgba(255, 226, 241, .88);
  font-size:1rem;
}

.tapMessage{
  margin:8px auto 0 auto;
  min-height:64px;
  max-width:560px;
  padding:10px 14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.12);
  color:#fff8fc;
  font-size:1.18rem;
  line-height:1.25;
  opacity:.45;
  transform:translateY(4px);
  transition:opacity .28s ease, transform .28s ease;
}

.tapMessage.show{
  opacity:1;
  transform:translateY(0);
}

#scene3 .panel{
  width:min(92vw, 640px);
  text-align:center;
}

#envelopeWrap{
  position:relative;
  width:min(84vw, 370px);
  height:min(52vw, 228px);
  margin:8px auto 0 auto;
  perspective:1100px;
  cursor:pointer;
}

#envBody{
  position:absolute;
  inset:0;
  border-radius:12px;
  background:linear-gradient(155deg, #fff6fb, #ffd9eb);
  box-shadow:0 14px 30px rgba(42, 5, 22, .42);
  overflow:hidden;
}

#envBody::before{
  content:"";
  position:absolute;
  left:0;
  right:0;
  bottom:0;
  margin:auto;
  width:90%;
  height:68%;
  clip-path:polygon(0 0, 50% 68%, 100% 0, 100% 100%, 0 100%);
  background:#ffc8e1;
}

#envFlap{
  position:absolute;
  inset:0;
  border-radius:12px;
  background:linear-gradient(180deg, #ffd6e8, #ffb6d7);
  clip-path:polygon(0 0, 100% 0, 50% 62%);
  transform-origin:50% 0%;
  transition:transform .9s ease;
  z-index:4;
  backface-visibility:hidden;
}

#seal{
  position:absolute;
  left:50%;
  top:44%;
  width:44px;
  height:44px;
  transform:translate(-50%, -50%);
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #ffd6ea, #f55b9e 70%, #bd1c63);
  box-shadow:0 0 16px rgba(247, 101, 165, .62);
  z-index:5;
  transition:opacity .45s ease, transform .45s ease;
}

#seal::before{
  content:"\2764";
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;
  color:#fff1f8;
  font-size:1rem;
}

#letterCard{
  margin:14px auto 0 auto;
  width:min(86vw, 520px);
  max-height:0;
  overflow:hidden;
  opacity:0;
  transform:translateY(16px) scale(.95);
  padding:0 16px;
  border-radius:16px;
  background:linear-gradient(160deg, rgba(255,255,255,.92), rgba(255,239,247,.96));
  color:#732247;
  text-align:left;
  font-size:1.05rem;
  line-height:1.35;
  white-space:pre-line;
  box-shadow:0 14px 24px rgba(42, 8, 25, .25);
  transition:max-height .9s ease, opacity .55s ease .2s, transform .55s ease .2s, padding .5s ease;
}

.letterPanel.opened #envFlap{
  transform:rotateX(168deg);
}

.letterPanel.opened #seal{
  opacity:0;
  transform:translate(-50%, -48%) scale(.75);
}

.letterPanel.opened #letterCard{
  max-height:min(66vh, 420px);
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  opacity:1;
  transform:translateY(0) scale(1);
  padding:16px 16px;
}

.nextHint{
  margin:6px 0 0 0;
  font-size:.92rem;
  color:rgba(255, 222, 239, .88);
}

#scene4 .panel,
#scene6 .panel,
#scene7 .panel{
  width:min(94vw, 980px);
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
  gap:18px;
  width:100%;
}

.songCard,
.featureCard,
.noteCard{
  border-radius:20px;
  border:1px solid rgba(255,255,255,.22);
  background:linear-gradient(150deg, rgba(255,255,255,.2), rgba(255,255,255,.08));
  box-shadow:0 12px 28px rgba(19, 2, 12, .45);
}

.songCard{
  padding:18px;
}

.songCard h4,
.featureCard p,
.quoteText,
.noteCard h4{
  font-family:"Sniglet", "Comic Sans MS", cursive;
  font-weight:400;
  letter-spacing:.02em;
}

.songCard h4{
  margin:0 0 5px 0;
  font-size:1.5rem;
  color:#ffe8f4;
}

.songCard p{
  margin:0 0 12px 0;
  color:rgba(255, 226, 241, .86);
}

.songControls{
  display:grid;
  grid-template-columns:auto 1fr auto;
  align-items:center;
  gap:10px;
}

.playBtn{
  border:none;
  border-radius:999px;
  padding:7px 11px;
  min-width:66px;
  font-family:"Sniglet", "Comic Sans MS", cursive;
  font-size:.8rem;
  background:#ffd6ea;
  color:#5a1e3a;
  cursor:pointer;
}

.progress{
  position:relative;
  height:8px;
  border-radius:999px;
  background:rgba(255, 255, 255, .2);
  overflow:hidden;
  cursor:pointer;
}

.progressFill{
  position:absolute;
  inset:0 auto 0 0;
  width:0%;
  border-radius:inherit;
  background:linear-gradient(90deg, #ff9ecf, #ff6fae);
}

.timeLabel{
  min-width:78px;
  text-align:right;
  font-size:.76rem;
  color:rgba(255, 234, 246, .86);
}

.songAudio{
  display:none;
}

#scene5 .panel{
  width:min(92vw, 760px);
  text-align:center;
}

.noteHint{
  margin:4px 0 0 0;
  font-size:.94rem;
  color:rgba(255, 224, 240, .86);
}

.messageStack{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
  margin-top:8px;
}

.noteCard{
  padding:12px 14px;
  text-align:left;
  opacity:0;
  transform:translateY(10px) scale(.98);
  cursor:pointer;
  user-select:none;
  overflow:hidden;
  transition:border-color .2s ease, background .2s ease, box-shadow .2s ease;
}

.noteCard:hover{
  border-color:rgba(255, 224, 240, .5);
  background:linear-gradient(150deg, rgba(255,255,255,.26), rgba(255,255,255,.11));
}

.noteCard:focus-visible{
  outline:2px solid rgba(255, 216, 236, .9);
  outline-offset:2px;
}

.noteCard h4{
  margin:0 0 4px 0;
  font-size:1.05rem;
  color:var(--pink-100);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.noteToggle{
  display:inline-grid;
  place-items:center;
  width:22px;
  height:22px;
  border-radius:50%;
  background:rgba(255, 198, 227, .28);
  color:#ffe8f5;
  font-size:1rem;
  line-height:1;
  transform:rotate(0deg);
  transition:transform .22s ease, background .22s ease;
}

.noteCard p{
  margin:0;
  color:rgba(255, 235, 245, .9);
  line-height:1.25;
  max-height:0;
  opacity:0;
  transform:translateY(-4px);
  overflow:hidden;
  transition:max-height .3s ease, opacity .24s ease, transform .24s ease, margin-top .24s ease;
}

.noteCard.open p{
  max-height:120px;
  opacity:1;
  transform:translateY(0);
  margin-top:6px;
}

.noteCard.open .noteToggle{
  transform:rotate(45deg);
  background:rgba(255, 198, 227, .44);
}

#scene5.active .noteCard{
  animation:noteIn .62s forwards;
  animation-delay:var(--delay);
}

#scene7 .panel{
  width:min(92vw, 900px);
  text-align:center;
}

.galleryGrid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(170px, 1fr));
  gap:14px;
  margin-top:8px;
}

.galleryCard{
  border-radius:16px;
  border:1px solid rgba(255, 255, 255, .2);
  overflow:hidden;
  background:linear-gradient(160deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
}

.featureCard,
.galleryCard{
  cursor:pointer;
  transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;
}

.featureCard:hover,
.galleryCard:hover{
  transform:translateY(-3px);
  border-color:rgba(255, 220, 240, .45);
  box-shadow:0 14px 30px rgba(19, 2, 12, .52);
}

.featureCard:focus-visible,
.galleryCard:focus-visible{
  outline:2px solid rgba(255, 216, 236, .9);
  outline-offset:2px;
}

.galleryCard img{
  width:100%;
  height:165px;
  object-fit:cover;
  display:block;
}

.galleryCard p{
  margin:0;
  padding:8px 10px;
  font-size:.95rem;
  color:rgba(255, 236, 246, .92);
}

#scene8 .panel{
  width:min(92vw, 760px);
  text-align:center;
}

.quoteText{
  margin:8px auto 4px auto;
  font-size:clamp(1.6rem, 3.4vw, 2.3rem);
  line-height:1.2;
  color:#fff6fb;
  text-shadow:0 1px 0 rgba(255, 255, 255, .08);
}

.quoteAuthor{
  margin:0;
  font-size:1rem;
  color:rgba(255, 220, 239, .86);
}

.featureCard{
  overflow:hidden;
  opacity:0;
  transform:translateY(14px);
  animation:cardIn .75s forwards;
}

.featureCard img{
  width:100%;
  height:220px;
  object-fit:cover;
}

.featureCard p{
  margin:0;
  padding:12px;
  font-size:1.23rem;
  color:#fff2fa;
}

#complimentModal{
  position:fixed;
  inset:0;
  z-index:90;
  display:grid;
  place-items:center;
  padding:18px;
  background:rgba(5, 2, 8, .72);
  backdrop-filter:blur(4px);
  opacity:0;
  pointer-events:none;
  transition:opacity .25s ease;
}

#complimentModal.open{
  opacity:1;
  pointer-events:auto;
}

.modalBox{
  width:min(92vw, 620px);
  max-height:min(84vh, 760px);
  overflow:auto;
  border-radius:22px;
  border:1px solid rgba(255, 255, 255, .3);
  background:linear-gradient(165deg, rgba(255,255,255,.93), rgba(255,235,246,.97));
  color:#5f1b3a;
  box-shadow:0 20px 36px rgba(10, 3, 8, .58);
  transform:translateY(10px) scale(.97);
  transition:transform .25s ease;
  position:relative;
}

#complimentModal.open .modalBox{
  transform:translateY(0) scale(1);
}

.modalClose{
  position:absolute;
  top:10px;
  right:10px;
  width:32px;
  height:32px;
  border:none;
  border-radius:50%;
  background:#ffd6ea;
  color:#6c2144;
  font-size:1.15rem;
  line-height:1;
  cursor:pointer;
}

.modalBody{
  padding:18px 16px 16px 16px;
}

.modalBody img{
  width:100%;
  max-height:260px;
  object-fit:cover;
  border-radius:14px;
  border:1px solid rgba(112, 33, 69, .16);
  box-shadow:0 8px 18px rgba(30, 8, 20, .22);
}

.modalBody h3{
  margin:12px 0 8px 0;
  font-size:1.4rem;
  color:#772448;
}

.modalList{
  margin:0;
  padding-left:20px;
}

.modalList li{
  margin:0 0 8px 0;
  color:#612341;
  line-height:1.3;
}

@keyframes pulse{
  0%,100%{ transform:translate(-50%, -50%) scale(1); opacity:.72; }
  50%{ transform:translate(-50%, -50%) scale(1.08); opacity:1; }
}

@keyframes giftStemGrow{
  0%{ height:0; border-radius:12px; }
  100%{ height:var(--stem-h, 340px); border-radius:999px; }
}

@keyframes giftLeafIn{
  0%{ opacity:0; }
  100%{ opacity:1; }
}

@keyframes giftRoseHeadIn{
  0%{ opacity:0; transform:translate(-50%, 8px) scale(.15); }
  100%{ opacity:1; transform:translate(-50%, -2px) scale(1); }
}

@keyframes giftPetalIn{
  0%{
    opacity:0;
    transform:translate(-50%, -50%) scale(.08) rotate(var(--rot));
  }
  60%{ opacity:1; }
  100%{
    opacity:1;
    transform:translate(-50%, -50%) translate(var(--x), var(--y)) rotate(var(--rot)) scale(var(--scale));
  }
}

@keyframes giftCenterIn{
  0%{ opacity:0; transform:translate(-50%, -50%) scale(.2); }
  100%{ opacity:1; transform:translate(-50%, -50%) scale(1); }
}

@keyframes giftRoseSway{
  0%,100%{ transform:rotate(2deg); }
  50%{ transform:rotate(-2deg); }
}

@keyframes giftRoseFromCenter{
  0%{
    left:50%;
    opacity:0;
    transform:
      translateX(-50%)
      translateY(26px)
      scale(var(--scale, .84))
      rotate(var(--tilt, 0deg));
  }
  100%{
    left:calc(50% + var(--x, 0px));
    opacity:1;
    transform:
      translateX(-50%)
      translateY(0)
      scale(var(--scale, .84))
      rotate(var(--tilt, 0deg));
  }
}

@keyframes giftLightFloat{
  0%{
    opacity:0;
    transform:translate3d(var(--x), 0, 0) scale(.65);
  }
  20%{ opacity:.82; }
  100%{
    opacity:0;
    transform:translate3d(calc(var(--x) + var(--drift)), -170px, 0) scale(1.25);
  }
}

@keyframes tapPulse{
  0%{ transform:scale(1); }
  50%{ transform:scale(1.04); }
  100%{ transform:scale(1); }
}

@keyframes cardIn{
  to{ opacity:1; transform:translateY(0); }
}

@keyframes noteIn{
  to{ opacity:1; transform:translateY(0) scale(1); }
}

@keyframes particleFloat{
  0%{ transform:translate3d(0, 0, 0) scale(.8); opacity:0; }
  10%{ opacity:.45; }
  90%{ opacity:.32; }
  100%{ transform:translate3d(var(--drift), -118vh, 0) scale(1.15); opacity:0; }
}

@keyframes heartFloat{
  0%{ transform:translate3d(0, 0, 0) rotate(45deg) scale(.72); opacity:0; }
  12%{ opacity:.74; }
  100%{ transform:translate3d(var(--drift), -122vh, 0) rotate(45deg) scale(1.1); opacity:0; }
}

@keyframes drift{
  0%{ transform:translate3d(0, 0, 0); }
  100%{ transform:translate3d(14px, -18px, 0); }
}

@media (max-width:740px){
  .scene{
    gap:12px;
    justify-content:flex-start;
    padding:
      calc(14px + env(safe-area-inset-top))
      calc(14px + env(safe-area-inset-right))
      calc(14px + env(safe-area-inset-bottom))
      calc(14px + env(safe-area-inset-left));
  }
  .sceneTitle{ font-size:clamp(1.9rem, 9vw, 2.8rem); }
  .sceneHint{ font-size:1rem; text-align:center; }
  #scene1{ padding-top:calc(24px + env(safe-area-inset-top)); }
  #roseStage{ height:min(69vh, 540px); }
  #roseStage .giftBouquet{ transform:scale(.92); }
  .panel{ border-radius:24px; padding:18px 14px; }
  .grid{ grid-template-columns:1fr; gap:12px; }
  .songControls{ grid-template-columns:auto 1fr; }
  .timeLabel{ grid-column:1 / -1; text-align:left; min-width:0; }
  #tapFlower{ width:246px; height:280px; }
  .tapMessage{ min-height:76px; font-size:1.05rem; }
  #letterCard{ font-size:.98rem; }
  .featureCard img{ height:176px; }
  .galleryCard img{ height:145px; }
  #scene8{ justify-content:center; }
}

@media (max-width:480px){
  .sceneTag{ font-size:.68rem; letter-spacing:.14em; }
  .panel{ border-radius:20px; padding:16px 12px; }
  button.nextBtn{ width:100%; max-width:260px; }
  #roseAura{ width:236px; height:236px; }
  #roseStage .giftBouquet{ transform:scale(.8); }
  #roseStage .giftRose__stemLeaf.left{ bottom:166px; }
  #roseStage .giftRose__stemLeaf.right{ bottom:226px; }
  #tapFlower{ width:200px; height:234px; }
  #tapFlower .giftRose{ bottom:4px; }
  .tapHead{ width:146px; height:146px; }
  .tapStem{ height:126px; }
  #envelopeWrap{
    width:min(90vw, 330px);
    height:min(56vw, 204px);
  }
  .galleryGrid{ grid-template-columns:1fr; }
  .featureCard p{ font-size:1.08rem; }
}

@media (max-height:760px){
  .scene{ justify-content:flex-start; }
  #scene1{ padding-top:calc(18px + env(safe-area-inset-top)); }
  #roseStage{ height:min(62vh, 500px); }
  #scene8{ justify-content:center; }
}

@media (max-height:620px){
  #roseStage{ height:min(58vh, 430px); }
  #letterCard{
    font-size:.94rem;
    max-height:min(70vh, 420px);
  }
  #scene8{ justify-content:center; }
}

@media (max-height:500px) and (orientation:landscape){
  .scene{ gap:10px; }
  .sceneTitle{ font-size:clamp(1.5rem, 5vw, 2.2rem); }
  #roseStage{ height:min(72vh, 360px); }
  #tapFlower{ width:176px; height:198px; }
}
</style>
</head>
<body>
<div class="ambient" id="particleField"></div>
<div class="ambient" id="heartField"></div>

<template id="giftRoseTemplate">
  <div class="giftRose" aria-hidden="true">
    <div class="giftRose__flower">
      <div class="giftRose__head">
        <span class="giftRose__petal" style="--x:-52px; --y:18px; --rot:-42deg; --scale:1.06; --petal-delay:2.35s;"></span>
        <span class="giftRose__petal" style="--x:52px; --y:18px; --rot:42deg; --scale:1.06; --petal-delay:2.42s;"></span>
        <span class="giftRose__petal" style="--x:-38px; --y:-20px; --rot:-18deg; --scale:1; --petal-delay:2.5s;"></span>
        <span class="giftRose__petal" style="--x:38px; --y:-20px; --rot:18deg; --scale:1; --petal-delay:2.58s;"></span>
        <span class="giftRose__petal" style="--x:0px; --y:24px; --rot:0deg; --scale:1.12; --petal-delay:2.66s;"></span>
        <span class="giftRose__petal" style="--x:-8px; --y:-34px; --rot:-6deg; --scale:.95; --petal-delay:2.74s;"></span>
        <span class="giftRose__petal" style="--x:8px; --y:-34px; --rot:6deg; --scale:.95; --petal-delay:2.8s;"></span>
        <span class="giftRose__petal core" style="--x:-12px; --y:-3px; --rot:-24deg; --scale:.78; --petal-delay:2.92s;"></span>
        <span class="giftRose__petal core" style="--x:12px; --y:-3px; --rot:24deg; --scale:.78; --petal-delay:2.98s;"></span>
        <span class="giftRose__petal core" style="--x:0px; --y:-16px; --rot:0deg; --scale:.7; --petal-delay:3.04s;"></span>
        <span class="giftRose__center"></span>
        <span class="giftRose__light" style="--x:-54px; --drift:-24px; --light-delay:.12s;"></span>
        <span class="giftRose__light" style="--x:-32px; --drift:10px; --light-delay:.42s;"></span>
        <span class="giftRose__light" style="--x:-8px; --drift:-8px; --light-delay:.75s;"></span>
        <span class="giftRose__light" style="--x:12px; --drift:6px; --light-delay:1.1s;"></span>
        <span class="giftRose__light" style="--x:34px; --drift:16px; --light-delay:1.48s;"></span>
        <span class="giftRose__light" style="--x:56px; --drift:20px; --light-delay:1.92s;"></span>
        <span class="giftRose__light" style="--x:-20px; --drift:-14px; --light-delay:2.24s;"></span>
        <span class="giftRose__light" style="--x:2px; --drift:14px; --light-delay:2.58s;"></span>
      </div>
      <div class="giftRose__stem"></div>
      <div class="giftRose__stemLeaf left"></div>
      <div class="giftRose__stemLeaf right"></div>
    </div>
  </div>
</template>

<div class="scene active" id="scene1">
  <div class="hero">
    <p class="sceneTag">A little surprise for you my baby</p>
    <h1 class="sceneTitle">Happy Rose Day Shereeen!</h1>
  </div>
  <div id="roseStage">
    <div id="roseAura"></div>
    <div class="giftBouquet" id="giftBouquet"></div>
  </div>
  <p class="sceneHint">A glowing bouquet blooms just for you.</p>
</div>

<div class="scene" id="scene2">
  <div class="panel">
    <p class="sceneTag">Tap the bloom</p>
    <h2 class="sceneTitle">A Soft Thought</h2>
    <div id="tapFlowerWrap">
      <button id="tapFlower" type="button" aria-label="Tap flower for message">
        <div class="tapBouquet" id="tapBouquet"></div>
      </button>
    </div>
    <p id="tapPrompt">Tap the flower and collect cute thoughts.</p>
    <p class="tapMessage" id="tapMessage">Your first tiny message is waiting.</p>
    <button class="nextBtn" id="softNextBtn" onclick="nextScene()" disabled>Continue</button>
  </div>
</div>

<div class="scene" id="scene3">
  <div class="panel letterPanel" id="letterPanel">
    <p class="sceneTag">Sealed with love</p>
    <h2 class="sceneTitle">A Little Letter</h2>
    <div id="envelopeWrap" aria-label="Open letter" role="button" tabindex="0">
      <div id="envBody"></div>
      <div id="envFlap"></div>
      <div id="seal"></div>
    </div>
    <div id="letterCard"></div>
    <p class="nextHint" id="letterHint">Tap the envelope</p>
  </div>
</div>

<div class="scene" id="scene4">
  <div class="panel">
    <p class="sceneTag">Playful playlist</p>
    <h2 class="sceneTitle">Songs For Us</h2>
    <div class="grid" id="songsGrid"></div>
    <button class="nextBtn" onclick="nextScene()">Next</button>
  </div>
</div>

<div class="scene" id="scene5">
  <div class="panel">
    <p class="sceneTag">Five tiny notes</p>
    <h2 class="sceneTitle">Just For You</h2>
    <p class="noteHint">Tap each message to expand it.</p>
    <div class="messageStack" id="messageStack"></div>
    <button class="nextBtn" onclick="nextScene()">Next</button>
  </div>
</div>

<div class="scene" id="scene6">
  <div class="panel">
    <p class="sceneTag">Everyday magic</p>
    <h2 class="sceneTitle">What I Adore</h2>
    <div class="grid" id="featuresGrid"></div>
    <button class="nextBtn" onclick="nextScene()">Next</button>
  </div>
</div>

<div class="scene" id="scene7">
  <div class="panel">
    <p class="sceneTag">Tiny memories</p>
    <h2 class="sceneTitle">Favorite Gallery</h2>
    <div class="galleryGrid" id="galleryGrid"></div>
    <button class="nextBtn" onclick="nextScene()">Next</button>
  </div>
</div>

<div class="scene" id="scene8">
  <div class="panel">
    <p class="sceneTag">A quote screen</p>
    <h2 class="sceneTitle">One Sweet Quote</h2>
    <blockquote class="quoteText" id="quoteText"></blockquote>
    <p class="quoteAuthor" id="quoteAuthor"></p>
  </div>
</div>

<div id="complimentModal" aria-hidden="true">
  <div class="modalBox" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <button class="modalClose" id="modalCloseBtn" type="button" aria-label="Close compliments box">x</button>
    <div class="modalBody">
      <img id="modalImage" src="" alt="">
      <h3 id="modalTitle"></h3>
      <ul class="modalList" id="modalList"></ul>
    </div>
  </div>
</div>

<script>
const CONFIG = {
  loveLetter:
`My love,

I do not know how to write something perfect,
but I know exactly how you make me feel.

You make my ordinary days feel gentle.
You make silence feel safe.
You make smiles come naturally.
You make my heart race.
You make me feel loved and cared for.
And most importantly you make me feel understood and seen.
Thank you for everything Shereen.

This rose blooms today only because of you.

Always yours.`,
  tapMessages: [
    "You make my day feel warmer in seconds.",
    "Your smile is my favorite weather.",
    "Even silence feels cozy with you.",
    "You turn little moments into memories.",
    "You are my softest, happiest thought.",
    "Your laugh is my instant comfort.",
    "I still blush when I think of you."
  ],
  notes: [
    "I adore how your eyes are so shiny.",
    "You make hard days feel soft and manageable.",
    "Your presence feels like home to my heart.",
    "You are always beautiful, even in ordinary moments and the low days.",
    "Thank you for being you. Every single day."
  ],
  quote: {
    text: "In all the world, there is no heart for me like yours.",
    author: "- Maya Angelou"
  },
  songs: [
    { title: "Chaandni", artist: "Sufr", file: "audio/chaandni.mp3" },
    { title: "Bargad", artist: "Arpit", file: "audio/bargad.mp3" }
  ],
  features: [
    {
      image: "images/eyes.png",
      caption: "Her eyes",
      compliments: [
        "Her eyes glow so bright they make every room feel softer.",
        "That eye contact feels like home and magic together.",
        "The sparkle in her eyes turns ordinary moments into memories.",
        "Her gaze carries calm, warmth, and so much love."
      ]
    },
    {
      image: "images/smiles.png",
      caption: "Her smile",
      compliments: [
        "Her smile is my favorite reason to pause and stare.",
        "One smile from her can fix my whole day instantly.",
        "It is the softest, prettiest curve in my world.",
        "Her smile has that rare kind of joy that feels honest and pure."
      ]
    },
    {
      image: "images/cuteness.png",
      caption: "Her cuteness",
      compliments: [
        "She is effortlessly cute in every little expression.",
        "Her tiny reactions are the most adorable thing ever.",
        "Even her random moments are unbelievably precious.",
        "Her cuteness is not just looks, it is her whole vibe."
      ]
    }
  ],
  gallery: [
    {
      image: "images/faveyes.png",
      caption: "My favorite eyes",
      compliments: [
        "These eyes are my favorite view on this planet.",
        "There is so much depth and sweetness in this look.",
        "I could get lost in these eyes and be happy about it.",
        "They shine with both strength and softness."
      ]
    },
    {
      image: "images/softsmile.png",
      caption: "That soft smile",
      compliments: [
        "This soft smile is pure peace to my heart.",
        "It feels like sunshine, comfort, and love at once.",
        "That gentle smile makes everything beautiful.",
        "I never get tired of this exact smile."
      ]
    },
    {
      image: "images/shocked.png",
      caption: "Her with glasses",
      compliments: [
        "She looks extra charming with glasses on.",
        "This look is equal parts cute, smart, and stunning.",
        "The glasses just frame her beauty even more.",
        "Every version of her is lovely, this one hits different."
      ]
    },
    {
      image: "images/hawt.png",
      caption: "Her being hawt ash",
      compliments: [
        "She looks absolutely gorgeous here, no debate.",
        "Confidence and beauty together suit her perfectly.",
        "She carries this look so effortlessly.",
        "This is one of those photos you cannot stop admiring."
      ]
    }
  ]
};

let current = 0;
const scenes = document.querySelectorAll(".scene");

function shouldUsePerfLite(){
  const narrowScreen = window.matchMedia("(max-width: 820px)").matches;
  const lowCpu = typeof navigator.hardwareConcurrency === "number" && navigator.hardwareConcurrency <= 6;
  const lowMemory = typeof navigator.deviceMemory === "number" && navigator.deviceMemory <= 4;
  return narrowScreen || lowCpu || lowMemory;
}

const PERF_LITE = shouldUsePerfLite();
if(PERF_LITE){
  document.body.classList.add("perf-lite");
}

function showScene(index){
  scenes.forEach((scene) => scene.classList.remove("active"));
  scenes[index].classList.add("active");
  current = index;
  document.body.classList.toggle("after-first", index > 0);
}

function nextScene(){
  if(current < scenes.length - 1){
    showScene(current + 1);
  }
}

const scene1 = document.getElementById("scene1");
const roseTemplate = document.getElementById("giftRoseTemplate");
const giftBouquet = document.getElementById("giftBouquet");
const tapBouquet = document.getElementById("tapBouquet");
let firstSceneAdvanced = false;

function createGiftRose(vars, isLive = false){
  const rose = roseTemplate.content.firstElementChild.cloneNode(true);
  Object.entries(vars).forEach(([name, value]) => {
    if(name === "from-center"){
      return;
    }
    rose.style.setProperty(`--${name}`, value);
  });
  if(vars["from-center"]){
    rose.classList.add("fromCenter");
  }
  if(isLive){
    rose.classList.add("is-live", "tapRose");
  }
  return rose;
}

function buildFirstBouquet(){
  giftBouquet.innerHTML = "";
  const bouquetConfig = [
    { x: "0px", scale: ".96", tilt: "0deg", z: "5", "rose-delay": "0s" },
    {
      x: "-92px", scale: ".88", tilt: "-10deg",
      z: "6", "rose-delay": ".24s", "from-center": true
    },
    {
      x: "92px", scale: ".88", tilt: "10deg",
      z: "6", "rose-delay": ".32s", "from-center": true
    },
    {
      x: "-154px", scale: ".76", tilt: "-16deg",
      z: "3", "rose-delay": ".48s", bottom: "20px", "from-center": true
    },
    {
      x: "154px", scale: ".76", tilt: "16deg",
      z: "3", "rose-delay": ".56s", bottom: "20px", "from-center": true
    }
  ];

  bouquetConfig.forEach((roseVars) => {
    giftBouquet.appendChild(createGiftRose(roseVars));
  });
}

function buildTapFlower(){
  tapBouquet.innerHTML = "";
  const tapConfig = [
    {
      x: "0px", scale: ".52", tilt: "0deg", z: "4", "rose-delay": ".02s", bottom: "6px",
      "stem-h": "250px", "leaf-left": "138px", "leaf-right": "188px"
    },
    {
      x: "-62px", scale: ".45", tilt: "-12deg", z: "3", "rose-delay": ".16s", bottom: "6px",
      "stem-h": "250px", "leaf-left": "138px", "leaf-right": "188px", "from-center": true
    },
    {
      x: "62px", scale: ".45", tilt: "12deg", z: "3", "rose-delay": ".24s", bottom: "6px",
      "stem-h": "250px", "leaf-left": "138px", "leaf-right": "188px", "from-center": true
    }
  ];

  tapConfig.forEach((roseVars) => {
    tapBouquet.appendChild(createGiftRose(roseVars, true));
  });
}

function bloomRose(){
  scene1.classList.add("bloomed");
  setTimeout(() => {
    if(current === 0 && !firstSceneAdvanced){
      firstSceneAdvanced = true;
      nextScene();
    }
  }, 7600);
}

const tapFlower = document.getElementById("tapFlower");
const tapMessage = document.getElementById("tapMessage");
const tapPrompt = document.getElementById("tapPrompt");
const softNextBtn = document.getElementById("softNextBtn");
let tapMessageIndex = 0;

function revealTapMessage(){
  const message = CONFIG.tapMessages[tapMessageIndex % CONFIG.tapMessages.length];
  tapMessage.textContent = message;
  tapMessage.classList.remove("show");
  void tapMessage.offsetWidth;
  tapMessage.classList.add("show");

  const count = tapMessageIndex + 1;
  tapPrompt.textContent = `Thought ${Math.min(count, CONFIG.tapMessages.length)} of ${CONFIG.tapMessages.length}`;
  tapFlower.classList.add("pulse");
  setTimeout(() => tapFlower.classList.remove("pulse"), 280);

  if(softNextBtn.disabled){
    softNextBtn.disabled = false;
  }

  tapMessageIndex++;
}

tapFlower.addEventListener("click", revealTapMessage);

const envelopeWrap = document.getElementById("envelopeWrap");
const letterPanel = document.getElementById("letterPanel");
const letterCard = document.getElementById("letterCard");
const letterHint = document.getElementById("letterHint");
let letterOpened = false;

letterCard.textContent = CONFIG.loveLetter;

function openLetter(){
  if(letterOpened){
    nextScene();
    return;
  }

  letterOpened = true;
  letterPanel.classList.add("opened");
  letterHint.textContent = "Scroll and read, then tap the envelope again to continue.";
}

envelopeWrap.addEventListener("click", openLetter);
envelopeWrap.addEventListener("keydown", (event) => {
  if(event.key === "Enter" || event.key === " "){
    event.preventDefault();
    openLetter();
  }
});

const songsGrid = document.getElementById("songsGrid");
CONFIG.songs.forEach((song) => {
  const card = document.createElement("div");
  card.className = "songCard";
  card.innerHTML = `
    <h4>${song.title}</h4>
    <p>${song.artist}</p>
    <div class="songControls">
      <button type="button" class="playBtn">Play</button>
      <div class="progress" aria-label="${song.title} progress">
        <div class="progressFill"></div>
      </div>
      <span class="timeLabel">0:00 / 0:00</span>
    </div>
    <audio class="songAudio" preload="metadata" src="${song.file}"></audio>
  `;
  songsGrid.appendChild(card);
  initSongPlayer(card);
});

function formatTime(seconds){
  if(!Number.isFinite(seconds)){
    return "0:00";
  }

  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins}:${secs.toString().padStart(2, "0")}`;
}

function pauseOtherPlayers(activeAudio){
  document.querySelectorAll(".songAudio").forEach((audio) => {
    if(audio !== activeAudio){
      audio.pause();
      const card = audio.closest(".songCard");
      if(card){
        const btn = card.querySelector(".playBtn");
        if(btn){
          btn.textContent = "Play";
        }
      }
    }
  });
}

function initSongPlayer(card){
  const playBtn = card.querySelector(".playBtn");
  const progress = card.querySelector(".progress");
  const progressFill = card.querySelector(".progressFill");
  const timeLabel = card.querySelector(".timeLabel");
  const audio = card.querySelector(".songAudio");

  const updateUI = () => {
    const duration = Number.isFinite(audio.duration) ? audio.duration : 0;
    const current = Number.isFinite(audio.currentTime) ? audio.currentTime : 0;
    const percent = duration > 0 ? (current / duration) * 100 : 0;
    progressFill.style.width = `${percent}%`;
    timeLabel.textContent = `${formatTime(current)} / ${formatTime(duration)}`;
  };

  playBtn.addEventListener("click", () => {
    if(audio.paused){
      pauseOtherPlayers(audio);
      const playPromise = audio.play();
      playBtn.textContent = "Pause";
      if(playPromise && typeof playPromise.catch === "function"){
        playPromise.catch(() => {
          playBtn.textContent = "Play";
        });
      }
    }else{
      audio.pause();
      playBtn.textContent = "Play";
    }
  });

  progress.addEventListener("click", (event) => {
    const rect = progress.getBoundingClientRect();
    const ratio = Math.max(0, Math.min(1, (event.clientX - rect.left) / rect.width));
    if(Number.isFinite(audio.duration)){
      audio.currentTime = audio.duration * ratio;
      updateUI();
    }
  });

  audio.addEventListener("loadedmetadata", updateUI);
  audio.addEventListener("timeupdate", updateUI);
  audio.addEventListener("durationchange", updateUI);
  audio.addEventListener("play", () => {
    playBtn.textContent = "Pause";
  });
  audio.addEventListener("pause", () => {
    if(!audio.ended){
      playBtn.textContent = "Play";
    }
  });
  audio.addEventListener("ended", () => {
    playBtn.textContent = "Play";
    updateUI();
  });
}

const messageStack = document.getElementById("messageStack");

function setNoteOpenState(card, open){
  card.classList.toggle("open", open);
  card.setAttribute("aria-expanded", open ? "true" : "false");
}

function toggleNoteCard(card){
  const shouldOpen = !card.classList.contains("open");
  messageStack.querySelectorAll(".noteCard.open").forEach((openCard) => {
    setNoteOpenState(openCard, false);
  });
  if(shouldOpen){
    setNoteOpenState(card, true);
  }
}

CONFIG.notes.forEach((note, i) => {
  const card = document.createElement("div");
  card.className = "noteCard";
  card.style.setProperty("--delay", `${i * 0.14}s`);
  card.setAttribute("role", "button");
  card.setAttribute("tabindex", "0");
  card.setAttribute("aria-expanded", "false");
  card.setAttribute("aria-label", `Open message ${i + 1}`);
  card.innerHTML = `
    <h4>Message ${i + 1}<span class="noteToggle" aria-hidden="true">+</span></h4>
    <p>${note}</p>
  `;
  card.addEventListener("click", () => toggleNoteCard(card));
  card.addEventListener("keydown", (event) => {
    if(event.key === "Enter" || event.key === " "){
      event.preventDefault();
      toggleNoteCard(card);
    }
  });
  messageStack.appendChild(card);
});

document.getElementById("quoteText").textContent = `\u201C${CONFIG.quote.text}\u201D`;
document.getElementById("quoteAuthor").textContent = CONFIG.quote.author;

const complimentModal = document.getElementById("complimentModal");
const modalImage = document.getElementById("modalImage");
const modalTitle = document.getElementById("modalTitle");
const modalList = document.getElementById("modalList");
const modalCloseBtn = document.getElementById("modalCloseBtn");
let lastFocusedCard = null;

function openComplimentModal(item){
  lastFocusedCard = document.activeElement;
  modalImage.src = item.image;
  modalImage.alt = item.caption;
  modalTitle.textContent = item.caption;
  modalList.innerHTML = "";

  const compliments = Array.isArray(item.compliments) ? item.compliments : [];
  compliments.forEach((line) => {
    const li = document.createElement("li");
    li.textContent = line;
    modalList.appendChild(li);
  });

  complimentModal.classList.add("open");
  complimentModal.setAttribute("aria-hidden", "false");
}

function closeComplimentModal(){
  complimentModal.classList.remove("open");
  complimentModal.setAttribute("aria-hidden", "true");
  modalImage.src = "";
  modalList.innerHTML = "";
  if(lastFocusedCard && typeof lastFocusedCard.focus === "function"){
    lastFocusedCard.focus();
  }
}

modalCloseBtn.addEventListener("click", closeComplimentModal);
complimentModal.addEventListener("click", (event) => {
  if(event.target === complimentModal){
    closeComplimentModal();
  }
});

document.addEventListener("keydown", (event) => {
  if(event.key === "Escape" && complimentModal.classList.contains("open")){
    closeComplimentModal();
  }
});

function bindCardPopup(card, item){
  card.setAttribute("role", "button");
  card.setAttribute("tabindex", "0");
  card.setAttribute("aria-label", `Open compliments for ${item.caption}`);

  card.addEventListener("click", () => {
    openComplimentModal(item);
  });

  card.addEventListener("keydown", (event) => {
    if(event.key === "Enter" || event.key === " "){
      event.preventDefault();
      openComplimentModal(item);
    }
  });
}

const featuresGrid = document.getElementById("featuresGrid");
CONFIG.features.forEach((item, i) => {
  const card = document.createElement("div");
  card.className = "featureCard";
  card.style.animationDelay = `${i * 0.14}s`;
  card.innerHTML = `
    <img src="${item.image}" alt="${item.caption}">
    <p>${item.caption}</p>
  `;
  bindCardPopup(card, item);
  featuresGrid.appendChild(card);
});

const galleryGrid = document.getElementById("galleryGrid");
CONFIG.gallery.forEach((item) => {
  const card = document.createElement("div");
  card.className = "galleryCard";
  card.innerHTML = `
    <img src="${item.image}" alt="${item.caption}">
    <p>${item.caption}</p>
  `;
  bindCardPopup(card, item);
  galleryGrid.appendChild(card);
});

function createParticles(){
  const field = document.getElementById("particleField");
  const count = PERF_LITE ? 16 : 34;

  for(let i = 0; i < count; i++){
    const p = document.createElement("span");
    p.className = "particle";
    p.style.setProperty("--left", `${Math.random() * 100}%`);
    p.style.setProperty("--size", `${2 + Math.random() * (PERF_LITE ? 3 : 5)}px`);
    p.style.setProperty("--dur", `${8 + Math.random() * (PERF_LITE ? 5 : 8)}s`);
    p.style.setProperty("--delay", `${Math.random() * -14}s`);
    p.style.setProperty("--drift", `${(Math.random() - 0.5) * (PERF_LITE ? 56 : 80)}px`);
    field.appendChild(p);
  }
}

function createHearts(){
  const field = document.getElementById("heartField");
  const count = PERF_LITE ? 8 : 16;

  for(let i = 0; i < count; i++){
    const h = document.createElement("span");
    h.className = "heartParticle";
    h.style.setProperty("--left", `${Math.random() * 100}%`);
    h.style.setProperty("--size", `${8 + Math.random() * (PERF_LITE ? 9 : 14)}px`);
    h.style.setProperty("--dur", `${11 + Math.random() * (PERF_LITE ? 6 : 9)}s`);
    h.style.setProperty("--delay", `${Math.random() * -20}s`);
    h.style.setProperty("--drift", `${(Math.random() - 0.5) * (PERF_LITE ? 86 : 140)}px`);
    field.appendChild(h);
  }
}

window.onload = () => {
  createParticles();
  createHearts();
  buildFirstBouquet();
  buildTapFlower();
  bloomRose();
};
</script>
</body>
</html>
